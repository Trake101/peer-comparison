<h3>
<%=@comparison.institution.inst_name%> Peer Group
</h3>
<p class="well well-small">
  <%if @comparison.filtered? then%>
    <strong>Institutional Filters: </strong>
    <%=@comparison.current_filters.collect{|f| "#{characteristic_description(f)}: #{@comparison.send(f)}"}.join("; ")%>
  <%else%>
    No institutional filters have been applied.
  <%end%>
</p>
<div class="btn-group pull-right">
  <% if @comparison.new_record? then %>
    <%=link_to "#", :class => "btn btn-default", 
            :onclick => "$('form#save_comparison').submit(); return false;" do%>
      <span class="icon-link"></span> Permalink</a>
    <%end%>

    <%=link_to "#", :class => "btn btn-default", 
            :onclick => "$('form#dl_comparison').submit(); return false;" do%>
      <span class="icon-file"></span> Download</a>
    <%end%>
  <%else%>
    <%=link_to(comparison_path(@comparison, :format => :csv), :class => "btn btn-default") do%>
      <span class="icon-file"></span> Download</a>
    <%end%>
  <%end%>
  <%=link_to root_path, :class => "btn btn-default" do%>
    <span class="icon-repeat"></span> Start Again
  <%end%>  

</div>
<% if @comparison.new_record?%>
  <%=form_for @comparison, :html => { :id => "save_comparison" } do |f|%>
    <%=f.hidden_field :institution_id%>
    <%(1..7).each do |n|%>
    <%=f.hidden_field "f#{n}_weight"%>
    <%end%>
    <%Comparison::CHARACTERISTIC_FILTERS.each do |filter|%>
    <%=f.hidden_field filter%>
    <%end%>
    <%=f.hidden_field :number_of_peers%>
    <%=hidden_field_tag :save, 1%>
  <%end%>

  <%=form_for @comparison, :html => { :id => "dl_comparison" }, :format => :csv, :method => :post do |f|%>
    <%=f.hidden_field :institution_id%>
    <%(1..7).each do |n|%>
    <%=f.hidden_field "f#{n}_weight"%>
    <%end%>
    <%Comparison::CHARACTERISTIC_FILTERS.each do |filter|%>
    <%=f.hidden_field filter%>
    <%end%>    
    <%=f.hidden_field :number_of_peers%>
    <%=hidden_field_tag :save, 0%>
  <%end%>
<%end%>

<br />
<table class="table table-striped table-hover table-condensed">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Institution (IPEDS ID)</th>
      <th>Factor Differences</th>
      <th>Distance *</th>
    </tr>
  </thead>
  <tbody>
    <%@peer_group.each_with_index do |i, index|%>
    <tr>
      <td><%=index+1%></td>
      <td><%=i.inst_name%> (<%=i.unit_id.to_i%>)</td>
      <td>
        <span class="inlinesparkline">
                    <%=@comparison.institution.factor_diff_string(i, @comparison)%>
                  </span>
      </td>
      <td><%=number_with_precision(i.distance_from(@comparison.institution, @comparison), precision: 3)%></td>
    </tr>
    <%end%>
  </tbody>
</table>
<p class="small muted">* Weights applied to each factor: <%=@comparison.weights%>.</p>
<script type="text/javascript">
  $('.inlinesparkline').sparkline('html', {type: 'bar', height: '20px', width: '100px', disableHiddenCheck: true});
</script>